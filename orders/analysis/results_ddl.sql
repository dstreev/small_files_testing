DROP DATABASE IF EXISTS ${DB} CASCADE;
CREATE DATABASE IF NOT EXISTS ${DB};

USE ${DB};

DROP TABLE IF EXISTS RESULTS_RAW;
CREATE EXTERNAL TABLE RESULTS_RAW
(
    LINE STRING
) PARTITIONED BY (DATASET STRING)
    LOCATION '/user/dstreev/datasets/orders_small_results';
SHOW CREATE TABLE RESULTS_RAW;
MSCK REPAIR TABLE RESULTS_RAW SYNC PARTITIONS;
-- Results RAW
SELECT *
FROM
    RESULTS_RAW
LIMIT 10;

DROP TABLE IF EXISTS METRICS;
CREATE TABLE METRICS
(
    ORIGIN   STRING,
    LINE_NUM BIGINT,
    METRIC   STRING,
    VALUE    DOUBLE
)PARTITIONED BY (DATASET STRING);
SHOW CREATE TABLE METRICS;

DROP TABLE IF EXISTS ACTIONS;
CREATE TABLE ACTIONS
(
    ORIGIN    STRING,
    LINE_NUM  BIGINT,
    ACTION    STRING,
    ACTION_TS TIMESTAMP
)PARTITIONED BY (DATASET STRING);

DROP TABLE IF EXISTS ORIGIN;
CREATE TABLE ORIGIN
(
    ORIGIN           STRING,
    STORAGE_LOCATION STRING,
    TABLE_TYPE       STRING,
    STATS            BOOLEAN,
    FILE_TYPE        STRING
)PARTITIONED BY (DATASET STRING);
SELECT * FROM ORIGIN where origin = 'bl_SLhdfs_TTacid_full_Strue_ORC_2023-04-03_19-00-59';

DROP TABLE IF EXISTS METRICS_BREAKDOWN;
CREATE TABLE METRICS_BREAKDOWN
(
    ORIGIN STRING,
    ACTION STRING,
    METRIC STRING,
    VALUE  BIGINT
)PARTITIONED BY (DATASET STRING);

DROP TABLE IF EXISTS ACTION_DURATION;
CREATE TABLE ACTION_DURATION
(
    ORIGIN   STRING,
    ACTION   STRING,
    START_TS TIMESTAMP,
    END_TS   TIMESTAMP
)PARTITIONED BY (DATASET STRING);
